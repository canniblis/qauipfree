<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>QauipFree Map</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; }
    #map {
      width: 100vw;
      height: 100vh;
      min-height: 100vh;
      background: #f0f0f0; /* Фон для диагностики */
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    // Вставь свой MapBox токен здесь
    mapboxgl.accessToken = 'pk.eyJ1IjoicWF1aXBmcmVlIiwiYSI6ImNtOGN2bG11NjJmMHoyanIzdGh5eWt6ankifQ.h5j64FxBh_zi9G3IdAGpZQ';

    // Проверка токена
    if (!mapboxgl.accessToken || mapboxgl.accessToken === 'YOUR_MAPBOX_ACCESS_TOKEN') {
      console.error('Ошибка: Вставьте валидный MapBox токен');
      alert('Карта не загрузилась: отсутствует токен MapBox');
      throw new Error('Неверный токен');
    }
    console.log('Токен:', mapboxgl.accessToken.slice(0, 10) + '...');

    // Проверка WebGL
    if (!mapboxgl.supported()) {
      console.error('Ошибка: WebGL не поддерживается');
      alert('Ваш браузер не поддерживает WebGL. Попробуйте другой браузер.');
      throw new Error('WebGL не поддерживается');
    }
    console.log('WebGL поддерживается');

    // Проверка ресурсов
    console.log('Ресурсы:');
    console.log('JS:', 'https://api.mapbox.com/mapbox-gl-js/v2.9.0/mapbox-gl.js');
    console.log('CSS:', 'https://api.mapbox.com/mapbox-gl-js/v2.9.0/mapbox-gl.css');

    // Проверка контейнера
    const mapContainer = document.getElementById('map');
    if (!mapContainer) {
      console.error('Ошибка: Контейнер #map не найден');
      alert('Ошибка: Контейнер карты не найден');
      throw new Error('Контейнер #map отсутствует');
    }
    console.log('Контейнер #map, размеры:', mapContainer.offsetWidth, 'x', mapContainer.offsetHeight);

    // Координаты (Алматы)
    const center = [76.8897, 43.2389];
    const zoom = 12;
    console.log('Центр:', center, 'Зум:', zoom);

    // Инициализация карты
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10', // Другой стиль для теста
        center: center,
        zoom: zoom
      });
      console.log('Карта инициализирована');
    } catch (error) {
      console.error('Ошибка инициализации карты:', error);
      alert('Ошибка загрузки карты. Проверьте токен и интернет.');
      throw error;
    }

    // Тестовый слой (красный круг)
    map.on('load', () => {
      console.log('Карта загружена');
      try {
        map.addSource('test-circle', {
          type: 'geojson',
          data: {
            type: 'Feature',
            geometry: {
              type: 'Point',
              coordinates: center
            }
          }
        });
        map.addLayer({
          id: 'test-circle',
          type: 'circle',
          source: 'test-circle',
          paint: {
            'circle-radius': 10,
            'circle-color': '#ff0000'
          }
        });
        console.log('Тестовый круг добавлен:', center);
      } catch (error) {
        console.error('Ошибка тестового круга:', error);
        alert('Ошибка добавления тестового круга');
      }
    });

    // Обработка ошибок карты
    map.on('error', (error) => {
      console.error('Ошибка загрузки карты:', error);
      alert('Ошибка загрузки карты: ' + error.message);
    });
  </script>
</body>
</html>